# CLAUDE.md

このファイルは、このリポジトリでコードを扱う際にClaude Code (claude.ai/code) にガイダンスを提供します。

## プロジェクト概要

これは原神のChrome拡張機能で、HoYoLABのコミュニティゲーム戦績ページで聖遺物のスコア計算を行います。この拡張機能は、ハイライトされた追加ステータスに基づいて聖遺物表示にスコア計算を追加します。

## コアアーキテクチャ

### 主要コンポーネント
- `manifest.json`: HoYoLAB戦績ページを対象とするChrome拡張機能のマニフェスト（v3）
- `content.js`: スコア計算機能を注入するメインコンテンツスクリプト
- `README.md`: インストールと使用方法の日本語ドキュメント

### 主要な技術詳細

**対象URL**: `https://act.hoyolab.com/app/community-game-records-sea/index.html`

**コンテンツスクリプトアーキテクチャ**:
- 初期化に`document.addEventListener('DOMContentLoaded')`を使用
- 動的なDOM変更を監視するMutationObserverパターンを実装
- Promise基盤の`waitForElement()`関数を使用して要素を待機
- 追加ステータス（`subPropsElementObserve`）とキャラクター情報（`basicInfoElementObserve`）の監視を維持

**スコア計算システム**:
- 公式ページでユーザーが選択したハイライト追加ステータスに基づいてスコアを計算
- 一般的な1:2:1の比率ではなく、会心ダメージ:会心率:攻撃力%の正確な比率を使用
- すべての聖遺物タイプ（花、羽、砂、杯、冠）をサポート
- スコア計算式は追加ステータスのタイプによって異なる（例：会心率 × 2.0、攻撃力%/HP% × 62.2/46.6）

**DOM操作**:
- ID `alk-element`でカスタムUI要素を作成
- 一貫した外観のために既存ページのスタイルをコピー
- 聖遺物リスト（`relic-list`）の上にスコア表示を挿入

### 使用されている要素セレクタ
- `.relic-list`: メインの聖遺物コンテナ
- `.sub-props .prop-list`: ハイライト追加ステータス選択エリア
- `.basic-info`: キャラクター情報セクション
- `.artifact-sub-prop`: 個別の聖遺物追加ステータス要素
- `.final-text`: 数値スタイリングの参照要素

## 開発ノート

- 拡張機能は日本語ユーザー向けに設計されている（すべてのテキストが日本語）
- ビルドプロセス不要 - 直接Chrome拡張機能の読み込み
- JSDoc型注釈を使用したバニラJavaScript
- 要素の可視性チェックによる防御的プログラミングを実装
- 適切な監視のクリーンアップで動的コンテンツ読み込みを処理

## インストール方法

この拡張機能はパッケージ化されていない読み込み方法を使用：
1. ファイルをダウンロードして展開
2. Chrome拡張機能でデベロッパーモードを有効化
3. パッケージ化されていない拡張機能フォルダを読み込み
4. 対象ページで拡張機能が自動的にアクティブ化

## 言語とローカライゼーション

現在日本語のみ。READMEに記載されているように、将来的に多言語サポートを予定。